{# Catalogue des produits : affiche la liste des produits avec filtres, tri et pagination #}
{% extends 'base.html.twig' %}

{% block title %}Produits - Auxilia E-commerce
{% endblock %}

{% block body %}
	<div class="container py-5">
		<div class="row mb-4 align-items-center">
			<div class="col-md-6">
				<h1 class="display-5 fw-bold text-primary mb-0">Catalogue Produits</h1>
				<p class="text-muted">Découvrez notre gamme complète d'articles</p>
			</div>
			<div class="col-md-6 text-md-end">
				<nav aria-label="breadcrumb">
					<ol class="breadcrumb justify-content-md-end mb-0">
						<li class="breadcrumb-item">
							<a href="{{ path('app_home') }}">Accueil</a>
						</li>
						<li class="breadcrumb-item active" aria-current="page">Produits</li>
					</ol>
				</nav>
			</div>
		</div>

		<div class="card border-0 shadow-sm rounded-4 mb-4">
			<div class="card-body p-4">
				<div class="row g-3">
					<div class="col-md-4 col-lg-3">
						<label for="category" class="form-label fw-bold small text-uppercase">Filtrer par catégorie</label>
						<select id="category" class="form-select border-0 bg-light" onchange="window.location.href=this.value">
							<option value="{{ path('app_product', {page: 1, limit: currentLimit, sort: currentSort, direction: currentDirection, q: q}) }}">Toutes les catégories</option>
							{% for category in categories %}
								<option value="{{ path('app_product', {page: 1, limit: currentLimit, sort: currentSort, direction: currentDirection, category: category.name, q: q}) }}" {% if currentCategory == category.name %} selected {% endif %}>
									{{ category.name }}
								</option>
							{% endfor %}
						</select>
					</div>

					<div class="col-md-4 col-lg-3">
						<label for="sort" class="form-label fw-bold small text-uppercase">Trier par</label>
						<select id="sort" class="form-select border-0 bg-light" onchange="window.location.href=this.value">
							<option value="{{ path('app_product', {page: 1, limit: currentLimit, sort: 'p.price', direction: 'asc', category: currentCategory, q: q}) }}" {% if currentSort == 'p.price' and currentDirection == 'asc' %} selected {% endif %}>Prix croissant</option>
							<option value="{{ path('app_product', {page: 1, limit: currentLimit, sort: 'p.price', direction: 'desc', category: currentCategory, q: q}) }}" {% if currentSort == 'p.price' and currentDirection == 'desc' %} selected {% endif %}>Prix décroissant</option>
							<option value="{{ path('app_product', {page: 1, limit: currentLimit, sort: 'p.name', direction: 'asc', category: currentCategory, q: q}) }}" {% if currentSort == 'p.name' and currentDirection == 'asc' %} selected {% endif %}>Nom (A-Z)</option>
						</select>
					</div>

					<div class="col-md-4 col-lg-2">
						<label for="limit" class="form-label fw-bold small text-uppercase">Par page</label>
						<select id="limit" class="form-select border-0 bg-light" onchange="window.location.href=this.value">
							<option value="{{ path('app_product', {page: 1, limit: 9, sort: currentSort, direction: currentDirection, category: currentCategory, q: q}) }}" {% if currentLimit == 9 %} selected {% endif %}>9 produits</option>
							<option value="{{ path('app_product', {page: 1, limit: 18, sort: currentSort, direction: currentDirection, category: currentCategory, q: q}) }}" {% if currentLimit == 18 %} selected {% endif %}>18 produits</option>
							<option value="{{ path('app_product', {page: 1, limit: 36, sort: currentSort, direction: currentDirection, category: currentCategory, q: q}) }}" {% if currentLimit == 36 %} selected {% endif %}>36 produits</option>
						</select>
					</div>

					{% if q %}
						<div class="col-lg-4 d-flex align-items-end">
							<div class="alert alert-info py-2 px-3 mb-0 w-100 d-flex justify-content-between align-items-center">
								<span>Résultats pour :
									<strong>{{ q }}</strong>
								</span>
								<a href="{{ path('app_product') }}" class="btn-close btn-close-sm" aria-label="Close"></a>
							</div>
						</div>
					{% endif %}
				</div>
			</div>
		</div>

		{% if pagination|length > 0 %}
			<div class="d-flex justify-content-between align-items-center mb-4 px-2">
				<div class="text-muted small">
					Affichage de
					<strong>{{ pagination.getPaginationData.firstItemNumber }}</strong>
					à
					<strong>{{ pagination.getPaginationData.lastItemNumber }}</strong>
					sur
					<strong>{{ pagination.getTotalItemCount }}</strong>
					produits
				</div>
				<div class="text-muted small d-none d-sm-block">
					Page
					<strong>{{ pagination.getCurrentPageNumber }}</strong>
					de
					<strong>{{ pagination.getPageCount }}</strong>
				</div>
			</div>

			<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4 mb-5">
				{% for product in pagination %}
					<div class="col">
						{% include 'components/product_card.html.twig' with {product: product} %}
					</div>
				{% endfor %}
			</div>

			<div class="d-flex justify-content-center">
				<div class="pagination-container">
					{{ knp_pagination_render(pagination) }}
				</div>
			</div>
		{% else %}
			<div class="text-center py-5">
				<div class="display-1 text-muted opacity-25 mb-4">
					<i class="fas fa-search"></i>
				</div>
				<h3 class="fw-bold">Aucun produit trouvé</h3>
				<p class="text-muted">Essayez de modifier vos filtres ou effectuez une nouvelle recherche.</p>
				<a href="{{ path('app_product') }}" class="btn btn-primary mt-3">Voir tout le catalogue</a>
			</div>
		{% endif %}
	</div>
{% endblock %}
